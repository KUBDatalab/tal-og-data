---
title: Tal og data fra KUB Datalab
output: html_document
htmlwidgets: TRUE
always_allow_html: true
---

Start med at læse og forstå dette:

Tallene trækkes fra vores kalendersystem. Vi tæller tilmeldinger.

Men vi registerer ikke i kalendersystemet hvor mange der dukkede op.

Det kunne vi godt. 

Men det gør vi ikke.

Så det kan vi ikke trække ud.

Det kunne være cool at samkøre data med vores kursus-registreringer.

Skaf mig en API-adgang til det, så skal det nok ske.

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
# source(here::here("rmd_config.R"))
wanted <- "KUB Datalab"
first_year <- 2018 # Det første år vi interesserer os for
aktuelt_year <- as.numeric(substr(Sys.Date(), 1, 4))

```

```{r source, include = FALSE}
source("collate_data.R", encoding = "UTF8") # henter data
```


Vi henter en gang om dagen, kl. 1 om natten UTC.

Sidst opdateret `r Sys.time()`


Vi trækker data gennem apien i vores kalendersystem og genererer denne 
rapport/oversigt/noget.

Ja, det ville være fint med interaktive grafer. Det er jeg mest vant til at 
arbejde med i Shiny, og det har vi ikke mulighed for (med mindre nogen giver
os lov til have vores egen server...)








Og så kan vi lave vores første output:
```{r}
all_events %>% 
  group_by(year(start)) %>% 
  distinct(id) %>% 
  summarise(antal = n())
```

Antal events i den ønskede kalender ofr de forskellige år.

BEMÆRK! der slettes events i kalenderen. Da disse data først er begyndt at blive
høstet 3. maj 2022, kan der være events der er blevet slettet fra kalenderen inden.
Det vil sige, at der sagtens kan have været flere events i 2020 end 24. 
Fremadrettet skulle data gerne være gemt for eftertiden her.

Hvordan med kategorierne over tid:
```{r}
all_events %>% 
  group_by(year(start)) %>% 
  distinct(id) %>% 
  summarise(antal = n())
```
Bemærk at en del kurser optræder i mere end en kategori. Så forvent
ikke at tallene summer til hvad du forventer.

Antal deltagere (som altså ikke nødvendigvis har deltaget, men har fået en af de udbudte pladser, forslag til alternativt ord modtages med taknemmelighed) og antal tilmeldinger på venteliste:
```{r}
all_events %>% 
  distinct(id, .keep_all = T) %>% 
  select(id, start) %>% 
  left_join(master_data, by=c("id"="event_id")) %>% 
  select(id,start,liste) %>% 
  group_by(id, start, liste) %>% 
  summarise(noget = n()) %>% 
  ungroup() %>% 
  arrange(desc(noget)) %>% 
  pivot_wider(names_from = liste,
             values_from = noget,
             values_fill = 0) %>% 
  group_by(år = year(start)) %>% 
  summarise(venteliste = sum(venteliste),
            deltager = sum(deltager))
```
Og husk! Der er forsvundet data fra kalendersystemet, så vi havde en del flere deltagere i 2020.

```{r}
all_events %>% 
  select(id, end)  %>% 
  distinct() %>% 
  mutate(periode = as.yearmon(end)) %>% 
  ggplot(aes(periode)) +
  geom_bar() +
  ggtitle("Antal aktiviteter i kalenderen en given måned")
```

